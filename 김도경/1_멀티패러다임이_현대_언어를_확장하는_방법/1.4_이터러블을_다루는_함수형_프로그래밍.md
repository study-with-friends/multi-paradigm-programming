# 1.4 ì´í„°ëŸ¬ë¸”ì„ ë‹¤ë£¨ëŠ” í•¨ìˆ˜í˜• í”„ë¡œê·¸ëž˜ë°

> ðŸ’¡ forEach, map, fiilter ì„¸ ê°€ì§€ í•¨ìˆ˜ë¥¼ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ì„œ, ì´í„°ëŸ¬ë¸”ê³¼ ì´í„°ë ˆì´í„°ë¥¼ ì§ì ‘ ë‹¤ë£¨ì–´ë³´ê¸°

## 1.4.1 forEach í•¨ìˆ˜

> í•¨ìˆ˜ì™€ ì´í„°ëŸ¬ë¸”ì„ ë°›ì•„ ì´í„°ëŸ¬ë¸”ì„ ìˆœíšŒí•˜ë©´ì„œ ê° ìš”ì†Œì— ì¸ìžë¡œ ë°›ì€ í•¨ìˆ˜ë¥¼ ì ìš©í•˜ëŠ” ê³ ì°¨ í•¨ìˆ˜
> 

```tsx
function forEach(f, iterable) {
  for (const val of iterable) {
    f(val)
  }
}

const array = [1,2,3,4,5]
forEach(console.log, array)
```

ë‹¤ìŒê³¼ ê°™ì´ while ë£¨í”„ë¥¼ í†µí•´ ì´í„°ë ˆì´í„°ë¥¼ ìˆœíšŒí•˜ë„ë¡ ë§Œë“¤ ìˆ˜ë„ ìžˆë‹¤

```tsx
function forEach(f, iterable) {
  const iterator = iterable[Symbol.iterator]()
  let result = iterator.next()
  
  while (!result.done) {
    f(result.value)
    result = iterator.next()
  }
}

const set = new Set([4,5,6])
forEach(console.log, set)
```

## 1.4.2 map í•¨ìˆ˜

ì´í„°ë ˆì´í„°ë¥¼ ì¸ìžë¡œ ë°›ì•„, ì´í„°ëŸ¬ë¸”ì´ìž ë™ì‹œì— ì´í„°ë ˆì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜

```tsx
function* map(f, iterable) {
    for (const val of iterable) {
        yield(f(val))
    }
}

const array = [1,2,3]
const mapped = map(x => x * 2, array)
// mapì€ ì´í„°ëŸ¬ë¸”ì„ ë°˜í™˜í•œë‹¤
console.log([...mapped]) // [2, 4, 6]

// ì œë„ˆë ˆì´í„° í•¨ìˆ˜ naturalsëŠ” ì´í„°ëŸ¬ë¸”ì´ìž ì´í„°ë ˆì´í„°ë¥¼ ë°˜í™˜
const mapped2 = map(x => x * 3, naturals(3))
// ë§µì€ ì´í„°ëŸ¬ë¸”ì„ ë°˜í™˜í•œë‹¤
forEach(console.log, mapped2)
```

while ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í•  ìˆ˜ ìžˆë‹¤.

```tsx
function* map(f, iterable) {
  const iterator = iterable[Symbol.iterator]()
  while (true) {
    const { value, done } = iterator.next()
    if (done) {
      break 
    } else {
      yield f(value)
    }
  }
}
```

ë§Œì•½ ì œë„ˆë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  êµ¬í˜„í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

ë°˜í™˜í•˜ëŠ” ê°’ì€ ì´í„°ëŸ¬ë¸”ì´ìž ì´í„°ë ˆì´í„°ì´ë¯€ë¡œ forâ€¦ofë‚˜ ì „ê°œ ì—°ì‚°ìžë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë‹¤.

```tsx
function map(f, iterable) {
    const iterator = iterable[Symbol.iterator]()
    return {
        next() {
            const { value, done } = iterator.next()
            return done
                ? { value, done }
                : { value: f(value), done}
        },
        [Symbol.iterator]() {
            return this
        }
    }
}

const iterator = function* () {
	yield 1
	yield 2
	yield 3
}() // ì´í„°ë ˆì´í„°ì´ìž ì´í„°ëŸ¬ë¸”

const mapped = map(x => x * 2, itertor)
// ì´í„°ë ˆì´í„°ì´ìž ì´í„°ëŸ¬ë¸”
[...mapped] // [2, 4, 6] 
```

## 1.4.3 filter í•¨ìˆ˜

> ì£¼ì–´ì§„ ì´í„°ëŸ¬ë¸”ì˜ ê° ìš”ì†Œì— ëŒ€í•´ ì¡°ê±´ì„ í™•ì¸í•˜ì—¬ í•´ë‹¹ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìš”ì†Œë“¤ë§Œ ë°˜í™˜í•˜ëŠ” ê³ ì°¨ í•¨ìˆ˜
> 

```tsx
function* filter(f, iterable) {
    for (const val of iterable) {
        if (f(val)) {
            yield val
        }
    }
}

const arr = [1,2,3,4,5]
const filtered = filter(x => x % 2 === 0, arr)

[...filtered] // [2, 4]
```

while ë¬¸ì„ ì‚¬ìš©í•œ êµ¬í˜„

```tsx
function filter(f, iterable) {
    const iterator = iterable[Symbol.iterator]()
    return {
        next() {
            const { value, done } = iterator.next()
            return done
                ? { value, done }
                : f(value)
                    ? { value, done }
                    : this.next() // ìž¬ê·€ -> ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ëª»í•œë‹¤ë©´ ë‹¤ì‹œ ìˆœíšŒë¥¼ ê³„ì†
        },
        [Symbol.iterator]() {
            return this
        }
    }
}
```

**í•¨ìˆ˜ê°€ ë°˜í™˜ë  ë•Œ ë§ˆì§€ë§‰ìœ¼ë¡œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ê°€ ìž¬ê·€ í˜¸ì¶œ**ì¸ ê²½ìš°, **ê¼¬ë¦¬ í˜¸ì¶œ ìµœì í™”(TCO, Tail Call Optimization)**ê°€ ê°€ëŠ¥í•œ ì½”ë“œì´ë‹¤.

- next() ë©”ì„œë“œì˜ this.next() í˜¸ì¶œì´ í•¨ìˆ˜ì˜ ë§ˆì§€ë§‰ í˜¸ì¶œì´ê³ , ê·¸ ê²°ê³¼ê°€ ì§ì ‘ ë°˜í™˜ë˜ê¸° ë•Œë¬¸ì— ê¼¬ë¦¬ í˜¸ì¶œ ìµœì í™”ê°€ ê°€ëŠ¥í•œ êµ¬ì¡°
- í•˜ì§€ë§Œ ES6ì˜ ê¼¬ë¦¬ ìž¬ê·€ ìµœì í™”ë¥¼ V8 ì—”ì§„ì—ì„œëŠ” ì§€ì›í•˜ì§€ ì•Šì•„ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œì˜ ìœ„í—˜ì´ ìžˆë‹¤.

ê¼¬ë¦¬ í˜¸ì¶œ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìžˆëŠ” ì½”ë“œ

```tsx
function filter(f, iterable) {
    const iterator = iterable[Symbol.iterator]()
    return {
        next() {
            do {
                const { value, done } = iterator.next()
                if (done) return { value, done }
                if (f(value)) return { value, done }
            } while (true) // ê²°ê³¼ì ìœ¼ë¡œëŠ” ê°™ì€ ì½”ë“œ
        },
        [Symbol.iterator]() {
            return this
        }
    }
}

// while ë¬¸ë§Œ ì‚¬ìš©
function filter(f, iterable) {
    const iterator = iterable[Symbol.iterator]()
    return {
        next() {
            while (true) {
                const { value, done } = iterator.next()
                if (done) return { value, done }
                if (f(value)) return { value, done }
            }
        },
        [Symbol.iterator]() {
            return this
        }
    }
}
```

- ìŠ¤ì¹¼ë¼ì™€ ì½”í‹€ë¦°ì˜ ê¼¬ë¦¬ ìž¬ê·€ ìµœì í™”
    - ê¼¬ë¦¬ ìž¬ê·€ í•¨ìˆ˜ë¥¼ **ë°˜ë³µë¬¸ í˜•íƒœë¡œ ë³€í™˜**í•˜ì—¬ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš°ë¥¼ ë°©ì§€

## 1.4.4 ê³ ì°¨ í•¨ìˆ˜ ì¡°í•©í•˜ê¸°

```tsx
forEach(console.log,
       map(x => x * 10,
          filter(x => x % 2 === 1,
                naturals(5))))
// 10
// 30
// 50
```

- naturals(5) ê²°ê³¼ë¥¼ â†’ 1ë¶€í„° 5ê¹Œì§€ ìžì—°ìˆ˜ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ì´í„°ë ˆì´í„°
- x % 2 === 1 ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§í•˜ê³  â†’ í™€ìˆ˜ë¥¼ ê±¸ëŸ¬ë‚´ëŠ” ì´í„°ë ˆì´í„°
- ëª¨ë‘ x * 10ìœ¼ë¡œ ë³€í™˜í•œ ë‹¤ìŒ â†’
- ê·¸ ê²°ê³¼ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ë¼

## 1.4.5 ìž¬ë¯¸ë‚œ filter

```tsx
function* filter(f, iterable) {
    for (const val of iterable) {
        yield* [val].filter(f)
    }
}

const array = [1,2,3,4,5]
const filtered = filter(x => x % 2 === 0, array)
console.log([...filtered]) // [2, 4]
```
